refactor main function
filter should work for any criteria
